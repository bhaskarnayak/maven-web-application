node{
    def mavenHome=tool name: "maven3.9.6"
echo"the node name is :${env.NODE_NAME}"
echo"the job name is :${env.JOB_NAME}"
echo"the build number is :${env.BUILD_NUMBER}"
properties([buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '7', daysToKeepStr: '', numToKeepStr: '6')), [$class: 'JobLocalConfiguration', changeReasonComment: '']])
    //checkout stage
    stage('checkoutcode'){
       git branch: 'development', url: 'https://github.com/bhaskarnayak/maven-web-application.git'
    }
    //build stage
    stage('build'){
        sh "$mavenHome/bin/mvn clean package"
    }
    //generate sonarqubereport
    stage('generatesonarqubereport'){
        sh "$mavenHome/bin/mvn sonar:sonar"
    }
    //upload artifact to nexus
    stage('uploadartifacttonexus'){
        sh "$mavenHome/bin/mvn deploy"
    }
    //deploy war to tomcat
    stage('deployingwartotomcat'){
        
        sshagent(['c7287eb2-801c-4ee2-bfea-653f7cd9feee']) {
    sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@54.90.176.8:/opt/apache-tomcat-9.0.84/webapps"
 
}
    }
}
